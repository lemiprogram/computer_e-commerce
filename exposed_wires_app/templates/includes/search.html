<!-- Search Bar -->
<div class="hidden md:flex flex-1 mx-6 relative">
  <div class="flex w-full">
    <input type="text" id="search-input" placeholder="Search categories..." 
           class="w-full px-4 py-2 pr-10 bg-white rounded-l-full focus:outline-none focus:ring-2 focus:ring-accent-100 font-bold">
    <button id="search-btn" 
            class="rounded-r-full bg-primary-200 text-black hover:text-accent-100 cursor-pointer px-4">
      <!-- Search Icon -->
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 cursor-pointer" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.5 3a7.5 7.5 0 016.15 13.65z" />
      </svg>
    </button>
  </div>

  <!-- Dropdown Menu -->
  <ul id="category-dropdown" 
      class="absolute top-full left-0 w-full shadow-lg rounded-b-lg hidden max-h-60 overflow-y-auto z-50">
  </ul>
</div>
<script>
  // Example categories (you can replace this with data from Django context or API)
  let categories = []

  const searchInput = document.getElementById("search-input");
  const searchBtn = document.getElementById("search-btn");
  const categoryDropdown = document.getElementById("category-dropdown");
  const productCount = {}
  // Function to filter categories
  async function filterCategories(query) {
    categories = await get_data(get_Categories_url+0)
    let products = await get_data(get_Products_url+0)
    categories.forEach(cat => {
      productCount[cat.name] = products.filter(prod => prod.category === cat.id)
    });
    return categories.filter(cat => cat.name.toLowerCase().includes(query.toLowerCase()));
  }

  // Show dropdown while typing
  searchInput.addEventListener("input", async () => {
    const query = searchInput.value.trim();
    categoryDropdown.innerHTML = "";

    if (query.length === 0) {
      categoryDropdown.classList.add("hidden");
      return;
    }
    categoryDropdown.classList.remove("hidden");

    const results = await filterCategories(query);

    if (results.length > 0) {
      results.forEach(cat => {
        
        const li = document.createElement("li");
        const img = document.createElement('img');
        const p = document.createElement('p');
        const count = document.createElement('span');
        const div = document.createElement('div');
        div.className = "flex gap-4 items-center"
        count.textContent = productCount[cat.name].length;
        count.className = "text-sm text-white bg-primary-100 w-8 h-8 rounded-full flex items-center justify-center";
        li.className = "flex gap-5 justify-between items-center p-2 w-full bg-bg-100 hover:bg-accent-100 text-text-100 hover:text-white cursor-pointer px-4 py-2";
        p.textContent = cat.name;
        p.className = "font-bold";

        img.src = "http://res.cloudinary.com/duxorzcjg/"+cat.image
        img.className = "w-10 h-10 object-contain rounded-full";

        div.appendChild(img);
        div.appendChild(p);
        li.appendChild(div);
        li.appendChild(count);
        li.addEventListener("click", () => {
          window.location.href = `/categories/${encodeURIComponent(cat.name)}`;
          searchInput.value = cat.name; // set clicked value
          categoryDropdown.classList.add("hidden");
        });
        categoryDropdown.appendChild(li);
      });
      categoryDropdown.classList.remove("hidden");
    } else {
      categoryDropdown.classList.add("hidden");
    }
  });

  // Handle search (Enter key or button)
  function handleSearch() {
    const query = searchInput.value.trim();
    if (query.length === 0) return;

    // Redirect to category page with query filter
    // Example: /categories/<category>/?q=<query>
    window.location.href = `/categories/${encodeURIComponent(query)}`;
  }

  // Search button click
  searchBtn.addEventListener("click", handleSearch);

  // Enter key press
  searchInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      handleSearch();
    }
  });

  // Close dropdown if clicked outside
  document.addEventListener("click", (e) => {
    if (!searchInput.contains(e.target) && !categoryDropdown.contains(e.target)) {
      categoryDropdown.classList.add("hidden");
    }
  });
</script>
